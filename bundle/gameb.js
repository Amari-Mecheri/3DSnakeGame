var f,W=!1,x={Ready:0,Dirty:1,Quit:2},d={State:0,ClearBoard:1,SnakeSize:2,SnakeHead:3,SnakeTail:5,SnakeDirection:7,Score:9,HighScore:10,Round:11,ListSprites:12,KeyDown:21,Candy:22,Snake:23,Space:24,End:25};(()=>{if(!(typeof global<"u"))if(typeof window<"u")window.global=window;else if(typeof self<"u")self.global=self;else throw new Error("cannot export Go (neither global, window nor self is defined)");!global.require&&typeof require<"u"&&(global.require=require),!global.fs&&global.require&&(global.fs=require("fs"));let n=()=>{let t=new Error("not implemented");return t.code="ENOSYS",t};if(!global.fs){let t="";global.fs={constants:{O_WRONLY:-1,O_RDWR:-1,O_CREAT:-1,O_TRUNC:-1,O_APPEND:-1,O_EXCL:-1},writeSync(i,o){t+=y.decode(o);let r=t.lastIndexOf(`
`);return r!=-1&&(console.log(t.substr(0,r)),t=t.substr(r+1)),o.length},write(i,o,r,p,k,S){if(r!==0||p!==o.length||k!==null){S(n());return}let _=this.writeSync(i,o);S(null,_)},chmod(i,o,r){r(n())},chown(i,o,r,p){p(n())},close(i,o){o(n())},fchmod(i,o,r){r(n())},fchown(i,o,r,p){p(n())},fstat(i,o){o(n())},fsync(i,o){o(null)},ftruncate(i,o,r){r(n())},lchown(i,o,r,p){p(n())},link(i,o,r){r(n())},lstat(i,o){o(n())},mkdir(i,o,r){r(n())},open(i,o,r,p){p(n())},read(i,o,r,p,k,S){S(n())},readdir(i,o){o(n())},readlink(i,o){o(n())},rename(i,o,r){r(n())},rmdir(i,o){o(n())},stat(i,o){o(n())},symlink(i,o,r){r(n())},truncate(i,o,r){r(n())},unlink(i,o){o(n())},utimes(i,o,r,p){p(n())}}}if(global.process||(global.process={getuid(){return-1},getgid(){return-1},geteuid(){return-1},getegid(){return-1},getgroups(){throw n()},pid:-1,ppid:-1,umask(){throw n()},cwd(){throw n()},chdir(){throw n()}}),!global.crypto){let t=require("crypto");global.crypto={getRandomValues(i){t.randomFillSync(i)}}}global.performance||(global.performance={now(){let[t,i]=process.hrtime();return t*1e3+i/1e6}}),global.TextEncoder||(global.TextEncoder=require("util").TextEncoder),global.TextDecoder||(global.TextDecoder=require("util").TextDecoder);let u=new TextEncoder("utf-8"),y=new TextDecoder("utf-8");var v=[];if(global.Go=class{constructor(){this._callbackTimeouts=new Map,this._nextCallbackTimeoutID=1;let t=()=>new DataView(this._inst.exports.memory.buffer),i=(e,s)=>{t().setUint32(e+0,s,!0),t().setUint32(e+4,Math.floor(s/4294967296),!0)},o=e=>{let s=t().getUint32(e+0,!0),l=t().getInt32(e+4,!0);return s+l*4294967296},r=e=>{let s=t().getFloat64(e,!0);if(s===0)return;if(!isNaN(s))return s;let l=t().getUint32(e,!0);return this._values[l]},p=(e,s)=>{if(typeof s=="number"){if(isNaN(s)){t().setUint32(e+4,2146959360,!0),t().setUint32(e,0,!0);return}if(s===0){t().setUint32(e+4,2146959360,!0),t().setUint32(e,1,!0);return}t().setFloat64(e,s,!0);return}switch(s){case void 0:t().setFloat64(e,0,!0);return;case null:t().setUint32(e+4,2146959360,!0),t().setUint32(e,2,!0);return;case!0:t().setUint32(e+4,2146959360,!0),t().setUint32(e,3,!0);return;case!1:t().setUint32(e+4,2146959360,!0),t().setUint32(e,4,!0);return}let a=this._ids.get(s);a===void 0&&(a=this._idPool.pop(),a===void 0&&(a=this._values.length),this._values[a]=s,this._goRefCounts[a]=0,this._ids.set(s,a)),this._goRefCounts[a]++;let c=1;switch(typeof s){case"string":c=2;break;case"symbol":c=3;break;case"function":c=4;break}t().setUint32(e+4,2146959360|c,!0),t().setUint32(e,a,!0)},k=(e,s,l)=>new Uint8Array(this._inst.exports.memory.buffer,e,s),S=(e,s,l)=>{let a=new Array(s);for(let c=0;c<s;c++)a[c]=r(e+c*8);return a},_=(e,s)=>y.decode(new DataView(this._inst.exports.memory.buffer,e,s)),z=Date.now()-performance.now();this.importObject={wasi_snapshot_preview1:{fd_write:function(e,s,l,a){let c=0;if(e==1)for(let g=0;g<l;g++){let h=s+g*8,m=t().getUint32(h+0,!0),b=t().getUint32(h+4,!0);c+=b;for(let w=0;w<b;w++){let A=t().getUint8(m+w);if(A!=13)if(A==10){let B=y.decode(new Uint8Array(v));v=[],console.log(B)}else v.push(A)}}else console.error("invalid file descriptor:",e);return t().setUint32(a,c,!0),0},fd_close:()=>0,fd_fdstat_get:()=>0,fd_seek:()=>0,proc_exit:e=>{if(global.process)process.exit(e);else throw"trying to exit with code "+e},random_get:(e,s)=>(crypto.getRandomValues(k(e,s)),0)},env:{"runtime.ticks":()=>z+performance.now(),"runtime.sleepTicks":e=>{setTimeout(this._inst.exports.go_scheduler,e)},"syscall/js.finalizeRef":e=>{console.error("syscall/js.finalizeRef not implemented")},"syscall/js.stringVal":(e,s,l)=>{let a=_(s,l);p(e,a)},"syscall/js.valueGet":(e,s,l,a)=>{let c=_(l,a),g=r(s),h=Reflect.get(g,c);p(e,h)},"syscall/js.valueSet":(e,s,l,a)=>{let c=r(e),g=_(s,l),h=r(a);Reflect.set(c,g,h)},"syscall/js.valueDelete":(e,s,l)=>{let a=r(e),c=_(s,l);Reflect.deleteProperty(a,c)},"syscall/js.valueIndex":(e,s,l)=>{p(e,Reflect.get(r(s),l))},"syscall/js.valueSetIndex":(e,s,l)=>{Reflect.set(r(e),s,r(l))},"syscall/js.valueCall":(e,s,l,a,c,g,h)=>{let m=r(s),b=_(l,a),w=S(c,g,h);try{let A=Reflect.get(m,b);p(e,Reflect.apply(A,m,w)),t().setUint8(e+8,1)}catch(A){p(e,A),t().setUint8(e+8,0)}},"syscall/js.valueInvoke":(e,s,l,a,c)=>{try{let g=r(s),h=S(l,a,c);p(e,Reflect.apply(g,void 0,h)),t().setUint8(e+8,1)}catch(g){p(e,g),t().setUint8(e+8,0)}},"syscall/js.valueNew":(e,s,l,a,c)=>{let g=r(s),h=S(l,a,c);try{p(e,Reflect.construct(g,h)),t().setUint8(e+8,1)}catch(m){p(e,m),t().setUint8(e+8,0)}},"syscall/js.valueLength":e=>r(e).length,"syscall/js.valuePrepareString":(e,s)=>{let l=String(r(s)),a=u.encode(l);p(e,a),i(e+8,a.length)},"syscall/js.valueLoadString":(e,s,l,a)=>{let c=r(e);k(s,l,a).set(c)},"syscall/js.valueInstanceOf":(e,s)=>r(e)instanceof r(s),"syscall/js.copyBytesToGo":(e,s,l,a,c)=>{let g=e,h=e+4,m=k(s,l),b=r(c);if(!(b instanceof Uint8Array)){t().setUint8(h,0);return}let w=b.subarray(0,m.length);m.set(w),i(g,w.length),t().setUint8(h,1)},"syscall/js.copyBytesToJS":(e,s,l,a,c)=>{let g=e,h=e+4,m=r(s),b=k(l,a);if(!(m instanceof Uint8Array)){t().setUint8(h,0);return}let w=b.subarray(0,m.length);m.set(w),i(g,w.length),t().setUint8(h,1)}}}}async run(t){this._inst=t,this._values=[NaN,0,null,!0,!1,global,this],this._goRefCounts=[],this._ids=new Map,this._idPool=[],this.exited=!1;let i=new DataView(this._inst.exports.memory.buffer);for(;;){let o=new Promise(r=>{this._resolveCallbackPromise=()=>{if(this.exited)throw new Error("bad callback: Go program has already exited");setTimeout(r,0)}});if(this._inst.exports._start(),this.exited)break;await o}}_resume(){if(this.exited)throw new Error("Go program has already exited");this._inst.exports.resume(),this.exited&&this._resolveExitPromise()}_makeFuncWrapper(t){let i=this;return function(){let o={id:t,this:this,args:arguments};return i._pendingEvent=o,i._resume(),o.result}}},global.require&&global.require.main===module&&global.process&&global.process.versions&&!global.process.versions.electron){process.argv.length!=3&&(console.error("usage: go_js_wasm_exec [wasm binary] [arguments]"),process.exit(1));let t=new Go;WebAssembly.instantiate(fs.readFileSync(process.argv[2]),t.importObject).then(i=>t.run(i.instance)).catch(i=>{console.error(i),process.exit(1)})}})();var q="wasm/gameState.wasm";WebAssembly.instantiateStreaming||(WebAssembly.instantiateStreaming=async(n,u)=>{let y=await(await n).arrayBuffer();return await WebAssembly.instantiate(y,u)});function F(n){let u=new Go;return u.importObject.env["syscall/js.finalizeRef"]=()=>{},new Promise((y,v)=>{WebAssembly.instantiateStreaming(fetch(n),u.importObject).then(t=>{u.run(t.instance),y(t.instance)}).catch(t=>{v(t)})})}function Y(n){F(q).then(u=>{n(),console.log("wasmLoaded")}).catch(u=>{console.log(u)})}var j=50,X={Width:j,Height:j},O,T,L,C,E,N,I,D,P,R,U,V=()=>{};function J(...n){return[U]=n,O=FreeSpace(),T=CandyBody(),L=SnakePart(),V=M,H()}function H(){if(!InitBoard(X)){U();let u=JSON.parse(CreateObjects());return G(),u}}function G(){C=Score(),E=HighScore(),N=SnakeSize(),I=Round(),D=JSON.parse(SnakePosition()),P=JSON.parse(SnakeTail()),R=JSON.parse(SnakeDirection())}function M(){if(GameInProgress()){let n=JSON.parse(Play());return G(),n}}function K(n){switch(n){case 1:case"ArrowLeft":MoveLeft();break;case 2:case"ArrowRight":MoveRight();break;case 3:case"ArrowUp":MoveUp();break;case 4:case"ArrowDown":MoveDown();break;case 5:case"Enter":break;case 6:case" ":if(!GameInProgress()){let u;return Dirty()&&(u=H()),Start(),u}break;default:break}}self.addEventListener("message",n=>{f=new Int32Array(n.data),Y(()=>{W=!0,f?(clearArray(),sendListSprite(J(U)),sendValues(),Atomics.store(f,d.State,x.Dirty),Atomics.wait(f,d.State,x.Dirty),mainLoop()):console.log("sharedArray not defined")})});mainLoop=()=>{for(;Atomics.load(f,d.State)!==x.Quit;){let n=Atomics.load(f,d.KeyDown);clearArray();let u;n!=0&&(u=K(n)),u?sendListSprite(u):sendListSprite(V()),sendValues(),Atomics.store(f,d.State,x.Dirty),Atomics.wait(f,d.State,x.Dirty)}};clearArray=()=>{for(let n=0;n<d.End;n++)Atomics.store(f,n,0)};sendValues=()=>{Atomics.store(f,d.SnakeSize,N),Atomics.store(f,d.SnakeHead,D.X),Atomics.store(f,d.SnakeHead+1,D.Y),Atomics.store(f,d.SnakeTail,P.X),Atomics.store(f,d.SnakeTail+1,P.Y),Atomics.store(f,d.SnakeDirection,R.DX),Atomics.store(f,d.SnakeDirection+1,R.DY),Atomics.store(f,d.Score,C),Atomics.store(f,d.HighScore,E),Atomics.store(f,d.Round,I),Atomics.store(f,d.Candy,T),Atomics.store(f,d.Snake,L),Atomics.store(f,d.Space,O)};sendListSprite=n=>{if(n)for(let u=0;u<n.length;u++){let y=n[u];Atomics.store(f,d.ListSprites+u*3,y.Value),Atomics.store(f,d.ListSprites+u*3+1,y.Position.X),Atomics.store(f,d.ListSprites+u*3+2,y.Position.Y)}};U=()=>{Atomics.store(f,d.ClearBoard,1)};
